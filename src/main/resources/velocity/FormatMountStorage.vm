import org.cloudifysource.utilitydomain.context.ServiceContextFactory

def context = ServiceContextFactory.getServiceContext()

// Note: Newer Linux kernels may rename your devices to /dev/xvdf through /dev/xvdp internally, even when the device name entered here (and shown in the details) is /dev/sdf through /dev/sdp.
def alternate = device.replaceAll("/s", "/xv")

if(context.attributes.thisInstance.volumeCreated) {
	println "formating the attached storage <${device}>... "
	try {
		context.storage.format(device, "$fileSystem")
	} catch(any) {
		device = alternate
		context.storage.format(device, "$fileSystem")
	}
}

println "mounting the attached storage <${device}> to <$location>... "
context.storage.mount(device, "$location")

return "$location"

